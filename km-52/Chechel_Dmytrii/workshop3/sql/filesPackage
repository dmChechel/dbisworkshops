CREATE OR REPLACE PACKAGE MIGRATION_FILES_PACKAGE AS
  TYPE T_MIGRATION_FILES IS RECORD (LINK VARCHAR2(255), MIGRATION_ID NUMBER, UPLOAD_TIMESTAMP TIMESTAMP, FILE_SIZE NUMBER);

  TYPE T_MIGRATION_FILES_TABLE IS TABLE OF T_MIGRATION_FILES;

  FUNCTION GET_MIGRATION_FILE(CURR_LINK IN MIGRATION_FILES.LINK%TYPE)
    RETURN T_MIGRATION_FILES_TABLE PIPELINED;
  FUNCTION GET_MIGRATION_FILES
    RETURN T_MIGRATION_FILES_TABLE PIPELINED;

 PROCEDURE SET_NEW_FILE(LINK     IN MIGRATION_FILES.LINK%TYPE,
                 FILE_SIZE    IN MIGRATION_FILES.FILE_SIZE%TYPE,
                 MIGRATION_ID IN MIGRATION_FILES.MIGRATION_ID%TYPE
                 );
END MIGRATION_FILES_PACKAGE;

CREATE OR REPLACE PACKAGE BODY MIGRATION_FILES_PACKAGE AS
  FUNCTION GET_MIGRATION_FILE(CURR_LINK IN MIGRATION_FILES.LINK%TYPE)
    RETURN T_MIGRATION_FILES_TABLE PIPELINED AS
    CURSOR MY_CUR IS
      SELECT *
      FROM MIGRATION_FILES
      WHERE MIGRATION_FILES.LINK = CURR_LINK;
    BEGIN
      FOR CURR IN MY_CUR
      LOOP
        PIPE ROW (CURR);
      end loop;
    END;

  FUNCTION GET_MIGRATION_FILES
    RETURN T_MIGRATION_FILES_TABLE PIPELINED AS
    CURSOR MY_CURSOR IS
      SELECT *
      FROM MIGRATION_FILES;
    BEGIN
      FOR REC IN MY_CURSOR
      LOOP
        PIPE ROW (REC);
      END LOOP;
    END;

 PROCEDURE SET_NEW_FILE(LINK     IN MIGRATION_FILES.LINK%TYPE,
                 FILE_SIZE    IN MIGRATION_FILES.FILE_SIZE%TYPE,
                 MIGRATION_ID IN MIGRATION_FILES.MIGRATION_ID%TYPE
                 ) AS
    BEGIN
      INSERT INTO MIGRATION_FILES (LINK, FILE_SIZE, MIGRATION_ID) VALUES (LINK, FILE_SIZE, MIGRATION_ID);
    END;
END MIGRATION_FILES_PACKAGE;

select * from table (MIGRATION_FILES_PACKAGE.GET_MIGRATION_FILE('https://sdfsd.com/dfasdsadasd'));
